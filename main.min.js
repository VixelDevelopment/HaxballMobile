const gameFrame=document.querySelector(".gameframe").contentWindow;let stylesheet=document.createElement("style");gameFrame.document.head.appendChild(stylesheet);let body=document.querySelector(".gameframe").contentWindow.document.body;document.querySelector("meta[name=viewport]").setAttribute("content","width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=0");var metaTag=document.createElement("meta");metaTag.setAttribute("http-equiv","X-UA-Compatible"),metaTag.setAttribute("content","ie=edge"),gameFrame.document.head.appendChild(metaTag);const VIRTUAL_JOYSTICK=!0,JOYSTICK=!0,HIDE_HEADER=!0,ADBLOCK=!0,ROOM_SEARCH=!0,CLIPBOARD_ROOM=!0,STORE_BUTTON=!0,ROOM_ADMIN_SETTINGS=!0,SHIRTS_BUTTON=!0,PASSWORD_BUTTON=!0,CUSTOM_CSS='.game-view>.top-section,.room-view{margin-top:0}.stats-view,[data-hook=ok]{text-transform:uppercase}*{user-select:none}body{background:#1a2125}[data-hook=leave-btn]{background:#c13535!important;margin-right:6px}.inputrow,.roomlist-view>.dialog>.splitter>.buttons>.file-btn,.sound-button-container,[data-hook=rec-btn],[data-hook=tvideo-lowlatency],[data-hook=tvideo-showavatars],[data-hook=tvideo-showindicators],[data-hook=tvideo-teamcol],div.chatbox-view>div>div.input,div:has(> [data-hook=chatbgmode]),div:has(> [data-hook=chatfocusheight-range]),div:has(> [data-hook=chatopacity-range]){display:none!important}div.chatbox-view>div>div.input{pointer-events:all}div.chatbox-view>div>div.input>input{overflow:hidden}.game-view>[data-hook=popups]{background-color:#1a212585!important}h1{border-bottom-color:#fec45b!important}.room-view{margin-bottom:0;height:100%}.room-view>.container{margin-top:auto!important;max-width:none;max-height:none;border-radius:0;width:100%;margin-bottom:30px}.room-view>.container>.header-btns{bottom:0;top:auto;display:flex;flex-flow:row-reverse;left:10px;right:auto}[data-hook=stadium-pick]{position:fixed!important;background:0 0!important;color:transparent!important;width:300px;height:20px}[data-hook=stadium-name]{text-decoration:underline}.room-view>.container>.controls{display:flex;align-self:center;position:absolute;bottom:0;right:10px;top:auto;margin-bottom:15px!important;z-index:1;flex-flow:row-reverse}.settings-view{width:100%;height:100%;max-height:unset;border-radius:0}.settings-view .tabcontents{width:100%;text-align:-webkit-center}.settings-view .section.selected{display:flex;width:max-content}.choose-nickname-view{flex-direction:row-reverse}.fade-out{opacity:0;transition:opacity 10s ease-out}.game-view>.bottom-section{position:absolute;bottom:0;left:0;width:100%;height:100%;pointer-events:none}.roomlist-view>.dialog,.view-wrapper>.dialog{max-width:calc(100vw - 2vw);max-height:calc(100vh - 2vw)}.chatbox-view-contents>.drag,.graph,.showing-room-view>.gameplay-section{display:none}body>div>div>div.dialog>p:nth-child(2){font-size:0%}body>div>.roomlist-view>div.dialog>p:nth-child(2)::after{font-size:medium;content:"HaxBall Mobile is now Open-Source. Feel free to make and publish improvements to the developer community";font-weight:700}.filters::after{content:"Vixel Dev 2024 - InjecThor";white-space:pre;font-style:italic}button[data-hook=shirt-btn]:after{content:"â—‘";font-size:1.25em}button[data-hook=shirt-btn]{margin-right:6px;margin-left:6px}div.chatbox-view>div>div.log.subtle-thin-scrollbar>div>p{display:none;text-shadow:1px 0 4px rgba(0,0,0,.66)}div.chatbox-view>div>div.log.subtle-thin-scrollbar>div>p:nth-last-child(-n+5){opacity:1;display:block;animation:10s forwards fadeOut}.log>div>p:has(br){display:none!important}@keyframes fadeOut{0%{opacity:1}100%{opacity:0;display:none}}.chatbox-view-contents{flex-direction:column-reverse;pointer-events:none;background:0 0;height:100vh;position:absolute;text-align:center;align-items:center;top:30px;width:100vw}.showing-room-view>.bottom-section>.chatbox-view>div{top:0!important}.chatbox-view-contents>.log{flex-direction:column}.chatbox-view{pointer-events:none;position:absolute;left:0;top:0;height:0!important;overflow-y:visible}.log-contents{display:flex;flex-direction:column-reverse}.stats-view{left:50%;bottom:0;background-color:transparent;text-shadow:1px 1px 1px #000,0 1px 1px #000;padding:8px;margin:4px;line-height:1.5em;position:absolute;text-align:center!important;opacity:.25;width:min-content;transform:translate(-50%,0);pointer-events:all;display:flex;flex-direction:column-reverse}.chatbox-view-contents>.autocompletebox{position:relative}',CUSTOM_LOGO={url:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' clip-rule='evenodd' image-rendering='optimizeQuality' shape-rendering='geometricPrecision' text-rendering='geometricPrecision' viewBox='0 0 2859 2858'%3E%3Cpath fill='%23eda242' d='M1249 0h124a139997 139997 0 0 1 548 550l2 120-1 3L1249 0Zm-143 26h2l788 789L816 1896 26 1106 1106 26Zm206 500c28 1 45 15 51 43l-11 357c-6 26-22 41-49 44a51 51 0 0 1-50-55l10-287-291 10c-31-3-49-20-51-51 2-27 16-43 43-49l348-12Zm-489 99c20-1 36 7 47 24l265 578c11 28 3 50-22 66-29 11-51 4-67-21L779 687c-4-34 11-55 44-62ZM587 920a52 52 0 0 1 50 43l-9 298 12 1c90-4 180-7 271-9 34-2 54 14 60 49-4 32-22 49-54 50l-338 12c-34-3-52-22-52-56l11-340c4-29 20-45 49-48ZM0 1371v-118l1-5 674 673a3825 3825 0 0 1-129-2L2 1376l-2-5Zm1543-36a5355 5355 0 0 1 61 63l-205 205h-3l-60-59v-2l207-207Zm206 202 170 172 2 4 2 210-1 207a13671 13671 0 0 1-175-176 23576 23576 0 0 1 2-417Zm-120 3 2 149-1 149-149-150 148-148Zm408 289 5 2 166 167 4 8v415l-172-171-3-7v-414Zm292 292 149 149-149 149v-298Zm231 233h3l60 61v2l-205 205h-2l-61-60v-3l205-205Zm299 261v2l-3 5-236 236h-7l-137-47c-3-3-4-7-3-10v-67c4-11 11-20 22-26l227-228c5-6 13-9 21-8h58c4-1 8 0 11 4l47 139Z'/%3E%3C/svg%3E",height:"100px"},CUSTOM_FONT={name:"Inter",type:"sans-serif",url:"https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap"};localStorage.getItem("low_latency_canvas")||(localStorage.setItem("low_latency_canvas",0),location.reload());const observer=new MutationObserver(onDOMChange),observerConfig={childList:!0,subtree:!0};function onDOMChange(t,e){getByDataHook("loader-view")||(body.querySelector(".roomlist-view")?(getByDataHook("search")||createSearchbar(),getByDataHook("url-room")||createURLButton(),filterRooms(getByDataHook("search").value),showControls(!1)):body.querySelector(".settings-view")?getByDataHook("inputopacity-value")||(createInputSettings(),createResetSettingsButton(),showControls(!1)):body.querySelector(".room-view")||body.querySelector(".showing-room-view")?(getByDataHook("store")||createStoreButton(),body.querySelector(".room-view .admin")&&(body.querySelectorAll(".player-list-item").forEach(roomAdminSettings),getByDataHook("shirt-btn")||createShirtButtons(),getByDataHook("password-btn")||createPasswordButton()),handleFPSText(),showControls(!1,!0)):!body.querySelector(".game-view")||body.querySelector(".showing-room-view")||body.querySelector(".settings-view")||(showControls(!0),handleFPSText()))}function showChatInput(t=!0){const e=body.querySelector(".chatbox-view").querySelector(".input"),n=e.querySelector("input");e.style="display: block !important;",t&&n.focus(),n.addEventListener("blur",hideChatInput)}function hideChatInput(){const t=body.querySelector(".chatbox-view").querySelector(".input");t.querySelector("input");t.style=""}observer.observe(body,observerConfig),document.querySelector(".rightbar").remove();const chatJoystick=document.createElement("div"),chatJoystickPanel=document.createElement("div"),chatStick=document.createElement("div"),chatJoystickLabel=document.createElement("p");let chatSelectedMessage=["",0];chatJoystick.setAttribute("id","chat-joystick"),chatJoystickPanel.setAttribute("id","chat-joystick-panel"),chatStick.setAttribute("id","chat-stick"),chatStick.innerHTML='<svg id="chat-svg" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 20 20"><path d="M5.8 12.2V6H2C.9 6 0 6.9 0 8v6c0 1.1.9 2 2 2h1v3l3-3h5c1.1 0 2-.9 2-2v-1.82a.943.943 0 0 1-.2.021h-7zM18 1H9c-1.1 0-2 .9-2 2v8h7l3 3v-3h1c1.1 0 2-.899 2-2V3c0-1.1-.9-2-2-2"/></svg>',chatJoystickLabel.setAttribute("id","chat-joystick-label"),chatJoystickLabel.innerText="GG!",document.body.appendChild(chatJoystickPanel),chatJoystickPanel.appendChild(chatJoystick),chatJoystick.appendChild(chatJoystickLabel),chatJoystick.appendChild(chatStick);let chatJoystickStylesheet=document.createElement("style");chatJoystickStylesheet.innerHTML="#chat-joystick,\n                                    #chat-stick {\n                                        /*touch-action: none;*/\n                                        color:#dedede55;\n                                        font-weight:bolder;\n                                        font-size:1.5rem;\n                                        border-radius: 50%;\n                                    }\n\n                                    #chat-joystick {\n                                        width: 120px;\n                                        height: 120px;\n                                        opacity: 1;\n                                        position: absolute;\n                                        right: 0;\n                                        top: 0;\n                                        margin:30px\n                                    }\n\n                                    #chat-joystick-panel {\n\t\t\t\t\t\t\t\t\t    width: min-content;\n\t\t\t\t\t\t\t\t\t    height: min-content;\n\t\t\t\t\t\t\t\t\t    position: absolute;\n\t\t\t\t\t\t\t\t\t    right: 0;\n\t\t\t\t\t\t\t\t\t    top: 35px;\n\t\t\t\t\t\t\t\t\t    display: none;\n                                        z-index: 3;\n                                        opacity: var(--joystick-opacity);\n\t\t\t\t\t\t\t\t\t}\n                                    \n                                    #chat-stick {\n                                        width: calc(100px * .45);\n                                        height: calc(100px * .45);\n                                        position: absolute;\n                                        top: 50%;\n                                        left: 50%;\n                                        transform: translate(-50%, -50%);\n                                        background-color:#244967;\n                                        display: flex;\n\t\t\t\t\t\t\t\t\t    align-items: center;\n\t\t\t\t\t\t\t\t\t    justify-content: center;\n                                        box-shadow: rgba(0, 0, 0, 0.66) 1px 0px 4px;\n                                        filter: saturate(1.4);\n                                    }\n\n                                    #chat-svg{\n                                    \tfill: #FFFFFF;\n                                    }\n\n                                    #chat-joystick-label{\n                                    \t    color: white;\n\t\t\t\t\t\t\t\t\t\t    position: absolute;\n\t\t\t\t\t\t\t\t\t\t    text-align: center;\n\t\t\t\t\t\t\t\t\t\t    top: 50%;\n\t\t\t\t\t\t\t\t\t\t    left: 50%;\n\t\t\t\t\t\t\t\t\t\t    transform: translate(-50%, -50%);\n\t\t\t\t\t\t\t\t\t\t    font-size: 0.8em;\n\t\t\t\t\t\t\t\t\t\t    font-family: 'Inter';\n\t\t\t\t\t\t\t\t\t\t    font-weight: normal;\n                                            text-shadow: 1px 0px 4px rgba(0,0,0,0.66);\n                                    }";let chatJoystickRootStylesheet=document.createElement("style");document.head.appendChild(chatJoystickStylesheet),document.head.appendChild(chatJoystickRootStylesheet);let isDraggingChatJoystick=!1;chatJoystickPanel.addEventListener("mousedown",startDrag),chatJoystickPanel.addEventListener("touchstart",startDrag),chatJoystickPanel.addEventListener("touchstart",chatToubleTouch),chatJoystickPanel.addEventListener("mouseup",endDrag),chatJoystickPanel.addEventListener("touchend",endDrag),chatJoystickPanel.addEventListener("mousemove",moveStick),chatJoystickPanel.addEventListener("touchmove",moveStick),resetChatStick();var chatTapedTwice=!1;function chatToubleTouch(t){if(!chatTapedTwice)return chatTapedTwice=!0,setTimeout((function(){chatTapedTwice=!1}),300),!1;t.preventDefault(),showChatInput()}function startDrag(t){isDraggingChatJoystick=!0,t.preventDefault()}function endDrag(t){isDraggingChatJoystick=!1,chatSelectedMessage[1]>30&&prefabMessage(chatSelectedMessage[0]),resetChatStick()}function moveStick(t){if(!isDraggingChatJoystick)return;const e=chatJoystick.getBoundingClientRect();chatStick.getBoundingClientRect();let n=t.clientX-e.left,o=t.clientY-e.top;"touchmove"===t.type&&(n=t.touches[0].clientX-e.left,o=t.touches[0].clientY-e.top);const i=chatJoystick.offsetWidth/2,a=chatJoystick.offsetHeight/2;let s=(n-i)/(chatJoystick.offsetWidth/2),c=(o-a)/(chatJoystick.offsetHeight/2);s=Math.min(1,Math.max(-1,s)),c=Math.min(1,Math.max(-1,c));let r=Math.atan2(o-a,n-i)*(180/Math.PI),l=Math.min(chatJoystick.offsetWidth/2,Math.sqrt(Math.pow(n-i,2)+Math.pow(o-a,2)));chatStick.style.transition="none",chatStick.style.transform=`translate(${l*Math.cos(r*(Math.PI/180))-i/2}px, ${l*Math.sin(r*(Math.PI/180))-a/2}px)`;l>30?(r>-25&&r<25?chatSelectedMessage[0]="GG!":r>65&&r<115?chatSelectedMessage[0]="Defending":r>-115&&r<-65?chatSelectedMessage[0]="Pass to me!":(r<-155||r>155)&&(chatSelectedMessage[0]="Teamwork!"),chatSelectedMessage[1]=l):(chatSelectedMessage[0]="",chatSelectedMessage[1]=0),chatJoystickLabel.innerText=chatSelectedMessage[0],chatJoystickLabel.style.opacity=l/50}function resetChatStick(){chatStick.style.transition="transform 0.4s ease-out",chatStick.style.transform="translate(-50%, -50%)",chatSelectedMessage[0]="",chatSelectedMessage[1]=0,chatJoystickLabel.style.opacity="0"}function createURLButton(){if(void 0!==CLIPBOARD_ROOM){let t=document.createElement("button");t.setAttribute("data-hook","url-room"),t.innerHTML='<i class="icon-link"></i><div>URL Room</div>',t.addEventListener("click",(function(){if(!body.querySelector('[data-hook="input-url"]')){let t=document.createElement("form");t.action="javascript:void(0);",t.innerHTML='<div class="label-input" style="background-color: transparent"><label>URL:</label><input data-hook="input-url" type="url"></div>';const e=document.createElement("div");e.className="label-input",e.style.backgroundColor="transparent",e.style.padding="0",e.style.display="flex",e.innerHTML='<label>URL:</label><br><input data-hook="input-url" type="url">',getByDataHook("search").parentNode.style.display="none",insertAfter(body.querySelector("div.dialog > p:nth-child(2)"),e);const n=e.querySelector("input");n.focus(),n.addEventListener("blur",(function(){getByDataHook("search").parentNode.style.display="flex",e.remove()})),n.addEventListener("submit",(function(){openHaxballURL(getByDataHook("input-url").value)}))}})),insertAfter(getByDataHook("join"),t)}}if(stylesheet.innerHTML+=CUSTOM_CSS,void 0!==CUSTOM_FONT){let t=document.createElement("link");t.href=CUSTOM_FONT.url,t.rel="stylesheet",gameFrame.document.head.appendChild(t),stylesheet.innerHTML+=`* {font-family: '${CUSTOM_FONT.name}', ${CUSTOM_FONT.type} !important;}`}function createPasswordButton(){if(void 0!==PASSWORD_BUTTON){let t=document.createElement("button");t.setAttribute("data-hook","password-btn"),t.style.fontSize="1em",t.style.padding="5px 0",t.classList.add("admin-only");let e=document.createElement("i");e.classList.add("icon-lock"),t.appendChild(e),t.innerHTML+="Password",insertAfter(getByDataHook("reset-all-btn"),t),t.addEventListener("click",(function(){createPasswordPopup()}))}}function createPasswordPopup(){const t=document.createElement("div");t.classList.add("dialog","basic-dialog","admin-only");const e=document.createElement("h1");e.textContent="Change password";const n=document.createElement("p");n.textContent="Enter the new password or leave the input empty to set the room as public";const o=document.createElement("input");o.setAttribute("data-hook","pass-input"),o.setAttribute("type","text"),o.setAttribute("maxlength","30"),o.setAttribute("placeholder","No password");const i=document.createElement("div");i.classList.add("buttons");const a=document.createElement("button");a.setAttribute("data-hook","close-pass"),a.textContent="Close";const s=document.createElement("button");s.setAttribute("data-hook","set-pass"),s.textContent="Set password",i.appendChild(a),i.appendChild(s),t.appendChild(e),t.appendChild(n),t.appendChild(o),t.appendChild(i);let c=getByDataHook("popups");getByDataHook("popups").appendChild(t),c.style.display="flex",o.onkeydown=function(t){t.stopPropagation()},a.onclick=function(){t.remove(),c.style.display="none"},s.onclick=function(){""==o.value?prefabMessage("/clear_password"):prefabMessage("/set_password "+o.value),t.remove(),c.style.display="none"}}function createResetSettingsButton(){const t=getByDataHook("miscsec");if(!getByDataHook("reset-all-btn")){let e=document.createElement("button");e.setAttribute("data-hook","reset-all-btn"),e.innerHTML="Reset all",t.appendChild(document.createElement("br")),t.appendChild(e),t.innerHTML+="<p style='font-size: small;font-style: italic;opacity: 0.5;'>You'll see changes next <br>time you open the app.",getByDataHook("reset-all-btn").addEventListener("click",(function(){localStorage.clear()}))}}function roomAdminSettings(t){if(void 0!==ROOM_ADMIN_SETTINGS){var e=!1;t.addEventListener("touchstart",(function(n){if(!e)return e=!0,setTimeout((function(){e=!1}),300),!1;n.preventDefault(),function(){var e=new MouseEvent("contextmenu",{bubbles:!0,cancelable:!0,view:window,button:2});t.dispatchEvent(e)}()}))}}function filterRooms(t){if(void 0!==ROOM_SEARCH){const e=t.toLowerCase();body.querySelectorAll("tr").forEach((t=>{const n=t.querySelector('span[data-hook="name"]');n&&!n.textContent.toLowerCase().includes(e)?t.style.display="none":t.removeAttribute("style")}))}}function createSearchbar(){if(void 0!==ROOM_SEARCH){const t=document.createElement("div");t.className="label-input",t.style.backgroundColor="transparent",t.style.padding="0",t.innerHTML='<label>Search a room:</label><br><input data-hook="search" placeholder="Type here..." type="text">';insertAfter(body.querySelector("div.dialog>p:nth-child(2)"),t);const e=t.querySelector("input");e.addEventListener("input",(function(){filterRooms(e.value)}))}}void 0!==CUSTOM_LOGO&&(stylesheet.innerHTML+=`.choose-nickname-view>img {content: url("${CUSTOM_LOGO.url}");height:${CUSTOM_LOGO.height||"auto"};width:${CUSTOM_LOGO.width||"auto"}}`),document.querySelector(".header").remove();const blueShirts={arg:"0 000000 FFFFFF 0D8ED9 FFFFFF",fra:"0 E8B320 0F0D4D",gbr:"90 151AA1 151AA1 FFFFFF FFFFFF",ita:"180 D4BA91 2D4E9D",hvr:"0 3A33FF EBE6FF DBDBDB FFFFFF",jpn:"30 F2F2F2 1930FF 0066FF 101FA3"},redShirts={bel:"0 000000 FF150D BD100A FF150D",bra:"0 167010 FFFF26 F7FF19 FFFF26",prt:"-60 FFCB21 0D3808 FF0D0D",nld:"0 0D0D40 FF9124 FFAE0D FF9124",esp:"0 EBC015 BF0000",mar:"FFFFFF 046317 FF0000 FF0000"};function getNextShirt(t){const e="red"===t?redShirts:blueShirts,n=Object.keys(e);getNextShirt.currentIndex=getNextShirt.currentIndex||{},getNextShirt.currentIndex[t]=getNextShirt.currentIndex[t]||0;const o=getNextShirt.currentIndex[t];return getNextShirt.currentIndex[t]=(o+1)%n.length,e[n[o]]}function pickShirt(t){if(void 0!==SHIRTS_BUTTON){const e=t.target.hasAttribute("red")?"red":"blue";prefabMessage(`/colors ${e} ${getNextShirt(e)}`)}}function createShirtButtons(){const t=document.createElement("button");t.setAttribute("data-hook","shirt-btn"),t.classList.add("admin-only"),t.setAttribute("red",""),t.onclick=pickShirt;const e=document.createElement("button");e.setAttribute("data-hook","shirt-btn"),e.classList.add("admin-only"),e.setAttribute("blue",""),e.onclick=pickShirt,body.querySelector(".t-red > .buttons").appendChild(t),body.querySelector(".t-blue > .buttons").appendChild(e)}function createStoreButton(){if(void 0!==STORE_BUTTON){let t=document.createElement("button");t.setAttribute("data-hook","store"),t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 407 407" fill="white" style="height:0.85em; width: auto"><path d="M402 84 323 5c-3-3-7-5-12-5H17C8 0 0 8 0 17v373c0 9 8 17 17 17h373c9 0 17-8 17-17V96c0-4-2-9-5-12zm-101 80H67V39h234v125z"></path><path d="M214 148h43c3 0 6-2 6-6V60c0-4-3-6-6-6h-43c-3 0-6 2-6 6v82c0 4 3 6 6 6z"></path></svg> Store',insertAfter(getByDataHook("rec-btn"),t),t.addEventListener("click",(function(){prefabMessage("/store")}))}}function getByDataHook(t){return body.querySelector('[data-hook="'+t+'"]')}function insertAfter(t,e){t.parentNode.insertBefore(e,t.nextSibling)}function openHaxballURL(t){const e=t.replace(/^https?:\/\/(www\.)?haxball\.com\/play\?c=/,"");e.length>0&&window.location.replace("https://www.haxball.com/play?c="+e)}function prefabMessage(t){const e=body.querySelector(".chatbox-view").querySelector("input");e.focus(),e.value=t,e.dispatchEvent(new KeyboardEvent("keydown",{key:"Enter",bubbles:!0,cancelable:!0,keyCode:13,which:13}))}function handleFPSText(){const t=localStorage.getItem("show_fps")||1;body.querySelector(".stats-view").style=1==t?"":"opacity: 0 !important;",body.querySelector(".stats-view").ontouchstart=function(t){1==(localStorage.getItem("show_fps")||1)?(localStorage.setItem("show_fps",0),t.target.style="opacity: 0 !important;"):(localStorage.setItem("show_fps",1),t.target.style="")}}if(void 0!==VIRTUAL_JOYSTICK){const e=document.createElement("div"),n=document.createElement("div"),o=document.createElement("div"),i=document.createElement("div");e.setAttribute("id","joystick"),n.setAttribute("id","joystick-panel"),o.setAttribute("id","kick-panel"),i.setAttribute("id","stick"),e.style.visibility="hidden",document.body.appendChild(o),document.body.appendChild(n),n.appendChild(e),e.appendChild(i);let a=document.createElement("style");a.innerHTML="#joystick,\n                                    #stick {\n                                        touch-action: none;\n                                        background-color:#c2c2c255;\n                                        box-shadow:6px 6px 10px 0 #a5abb133,-5px -5px 9px 0 #a5abb133;\n                                        color:#dedede55;\n                                        font-weight:bolder;\n                                        font-size:1.5rem;\n                                        border-radius: 50%;\n                                    }\n\n                                    #joystick {\n                                        width: var(--joystick-size);\n                                        height: var(--joystick-size);\n                                        opacity: var(--joystick-opacity);\n                                        position: absolute;\n                                        left: var(--joystick-margin);\n                                        bottom: var(--joystick-margin);\n                                    }\n\n                                    #joystick-panel {\n                                        width: 45%;\n                                        height: 70%;\n                                        position: absolute;\n                                        left: 0;\n                                        bottom: 0;\n                                        display:none;\n                                    }\n\n                                    #kick-panel {\n                                        width: 45%;\n                                        height: 70%;\n                                        position: absolute;\n                                        right: 0;\n                                        bottom: 0;\n                                        display:none;\n                                    }\n\n                                    #stick {\n                                        width: calc(var(--joystick-size) * .45);\n                                        height: calc(var(--joystick-size) * .45);\n                                        position: absolute;\n                                        top: calc(50% - var(--joystick-size) * .45 /2);\n                                        left: calc(50% - var(--joystick-size) * .45 /2);\n                                        transform: translate(0%, 0%)\n                                    }";let s=document.createElement("style");document.head.appendChild(a),document.head.appendChild(s);let c=!1;let r={W:0,A:0,S:0,D:0};const l=1/40*1e3;let d=l*r,h=l-d;function startDrag(t){c=!0;if(0==(localStorage.getItem("input_fixed")||0)){const n=e.getBoundingClientRect();let o=t.touches[0].clientX-n.left,i=t.touches[0].clientY-n.top;o-=e.offsetWidth/2,i-=e.offsetHeight/2,e.style.transform=`translate(${o}px,${i}px)`}e.style.visibility="visible",t.preventDefault()}function endDrag(t){c=!1;0==(localStorage.getItem("input_fixed")||0)&&(e.style.transform="",e.style.visibility="hidden"),resetStick()}function moveStick(t){if(!c)return;localStorage.getItem("input_pwm");const n=e.getBoundingClientRect();let o=t.clientX-n.left,a=t.clientY-n.top;"touchmove"===t.type&&(o=t.touches[0].clientX-n.left,a=t.touches[0].clientY-n.top);const s=e.offsetWidth/2,r=e.offsetHeight/2;let l=o-s,d=a-r;const h=Math.sqrt(l**2+d**2),u=Math.min(s,r),p=Math.min(1,h/u);let m=Math.atan2(d,l)*(180/Math.PI);if(m<0&&(m+=360),p>.25){switch(Math.round(m/45)%8){case 0:changeJoystickDirection("d");break;case 1:changeJoystickDirection("sd");break;case 2:changeJoystickDirection("s");break;case 3:changeJoystickDirection("sa");break;case 4:changeJoystickDirection("a");break;case 5:changeJoystickDirection("wa");break;case 6:changeJoystickDirection("w");break;case 7:changeJoystickDirection("wd")}}else changeJoystickDirection("");l=l/h*p*u,d=d/h*p*u,i.style.transition="none",i.style.transform=`translate(${l}px, ${d}px)`}function changeJoystickDirection(t){let e={w:!1,a:!1,s:!1,d:!1};for(var n=0;n<t.length;n++){e[t[n]]=!0}try{emulateKey("KeyW",e.w),emulateKey("KeyA",e.a),emulateKey("KeyS",e.s),emulateKey("KeyD",e.d)}catch{}}function resetStick(){i.style.transition="transform 0.1s ease-out",i.style.transform="translate(0%, 0%)",r.W=0,r.A=0,r.S=0,r.D=0,changeJoystickDirection("")}function joystickTick(t){const e=1==(localStorage.getItem("input_pwm")||0);d=l*r[t],h=l-d,r[t]>.1&&e&&emulateKey("Key"+[t],!0),setTimeout((()=>{r[t]<.85&&e&&emulateKey("Key"+[t],!1),setTimeout((function(){joystickTick(t)}),h)}),d)}function emulateKey(t,e){e?gameFrame.document.dispatchEvent(new KeyboardEvent("keydown",{code:t})):gameFrame.document.dispatchEvent(new KeyboardEvent("keyup",{code:t}))}function startKick(){emulateKey("KeyX",!0)}function endKick(){emulateKey("KeyX",!1)}function showControls(t,i=!1){if(void 0!==VIRTUAL_JOYSTICK)if(t){const t=localStorage.getItem("input_fixed")||0;n.style.display="block",o.style.display="block",document.body.querySelector("#chat-joystick-panel").style.display="block",1==t&&(e.style.transform="",e.style.visibility="visible"),reloadJoystickRoot()}else n.style.display="none",o.style.display="none",e.style.transform="",e.style.visibility="hidden",i||(document.body.querySelector("#chat-joystick-panel").style.display="none")}function createInputSettings(){const t=getByDataHook("inputsec"),e=localStorage.getItem("input_opacity")||.8,n=localStorage.getItem("input_size")||40,o=localStorage.getItem("input_fixed")||0,i=(localStorage.getItem("input_pwm"),localStorage.getItem("input_margin")||10),a=document.createElement("div");a.classList.add("option-row");const s=document.createElement("div");s.setAttribute("style","margin-right: 10px; flex: 1; max-width: 115px;"),s.textContent="Controls Opacity";const c=document.createElement("div");c.setAttribute("style","width: 40px"),c.setAttribute("data-hook","inputopacity-value");const r=document.createElement("input");r.classList.add("slider"),r.setAttribute("type","range"),r.setAttribute("min","0.25"),r.setAttribute("max","1"),r.setAttribute("step","0.01"),r.setAttribute("data-hook","inputopacity-range"),r.onchange=inputOpacityChange,r.oninput=inputOpacityChange,r.value=e,c.innerText=r.value,a.appendChild(s),a.appendChild(c),a.appendChild(r);const l=document.createElement("div");l.classList.add("option-row");const d=document.createElement("div");d.setAttribute("style","margin-right: 10px; flex: 1; max-width: 115px;"),d.textContent="Joystick Size";const h=document.createElement("div");h.setAttribute("style","width: 40px"),h.setAttribute("data-hook","inputsize-value");const u=document.createElement("input");u.classList.add("slider"),u.setAttribute("type","range"),u.setAttribute("min","30"),u.setAttribute("max","50"),u.setAttribute("step","1"),u.setAttribute("data-hook","inputsize-range"),u.onchange=inputSizeChange,u.oninput=inputSizeChange,u.value=n,h.innerText=u.value,l.appendChild(d),l.appendChild(h),l.appendChild(u);const p=document.createElement("div");p.classList.add("option-row");const m=document.createElement("div");m.setAttribute("style","margin-right: 10px; flex: 1; max-width: 115px;"),m.textContent="Joystick Margin";const y=document.createElement("div");y.setAttribute("style","width: 40px"),y.setAttribute("data-hook","inputmargin-value");const g=document.createElement("input");g.classList.add("slider"),g.setAttribute("type","range"),g.setAttribute("min","0"),g.setAttribute("max","35"),g.setAttribute("step","1"),g.setAttribute("data-hook","inputmargin-range"),g.onchange=inputMarginChange,g.oninput=inputMarginChange,g.value=i,y.innerText=g.value,p.appendChild(m),p.appendChild(y),p.appendChild(g);const v=document.createElement("div");v.classList.add("toggle");const b=document.createElement("i");1==o?(b.classList.add("icon-ok"),p.style.display="flex"):(b.classList.add("icon-cancel"),p.style.display="none"),v.appendChild(b),v.innerHTML+="Fixed Joystick",v.onclick=inputFixedChange,t.appendChild(v),t.appendChild(p),t.appendChild(a),t.appendChild(l),reloadJoystickRoot()}function inputOpacityChange(t){localStorage.setItem("input_opacity",t.target.value),t.target.parentNode.children[1].innerText=t.target.value,"input"==t.type?(n.style.display="block",e.style.visibility="visible",e.style.transform="",chatJoystickPanel.style.display="block"):(n.style.display="none",e.style.visibility="hidden",chatJoystickPanel.style.display="none"),reloadJoystickRoot()}function inputMarginChange(t){localStorage.setItem("input_margin",t.target.value),t.target.parentNode.children[1].innerText=t.target.value,"input"==t.type?(n.style.display="block",e.style.visibility="visible",e.style.transform=""):(n.style.display="none",e.style.visibility="hidden"),reloadJoystickRoot()}function inputFixedChange(t){let n=t.target.children[0];n.classList.contains("icon-cancel")?(n.classList.add("icon-ok"),n.classList.remove("icon-cancel"),getByDataHook("inputmargin-range").parentNode.style.display="flex",localStorage.setItem("input_fixed",1)):(n.classList.remove("icon-ok"),n.classList.add("icon-cancel"),e.style.visibility="hidden",getByDataHook("inputmargin-range").parentNode.style.display="none",localStorage.setItem("input_fixed",0)),reloadJoystickRoot()}function inputPWMChange(t){let n=t.target.children[0];n.classList.contains("icon-cancel")?(n.classList.add("icon-ok"),n.classList.remove("icon-cancel"),localStorage.setItem("input_pwm",1)):(n.classList.remove("icon-ok"),n.classList.add("icon-cancel"),e.style.visibility="hidden",localStorage.setItem("input_pwm",0)),changeJoystickDirection("")}function inputSizeChange(t){localStorage.setItem("input_size",t.target.value),t.target.parentNode.children[1].innerText=t.target.value,"input"==t.type?(n.style.display="block",e.style.visibility="visible",e.style.transform=""):(n.style.display="none",e.style.visibility="hidden"),reloadJoystickRoot()}function reloadJoystickRoot(){const t=localStorage.getItem("input_opacity")||.8,e=localStorage.getItem("input_size")||40;let n;n=1==(localStorage.getItem("input_fixed")||0)?localStorage.getItem("input_margin")||10:0,s.innerHTML=":root {--joystick-size: "+e+"vh;--joystick-margin: "+n+"vh;--joystick-opacity: "+t+"}"}n.addEventListener("mousedown",startDrag),n.addEventListener("touchstart",startDrag),n.addEventListener("mouseup",endDrag),n.addEventListener("touchend",endDrag),n.addEventListener("mousemove",moveStick),n.addEventListener("touchmove",moveStick),o.addEventListener("mousedown",startKick),o.addEventListener("touchstart",startKick),o.addEventListener("mouseup",endKick),o.addEventListener("touchend",endKick)}
